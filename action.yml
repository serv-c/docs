name: 'servc spec test'
description: Tests a service library against the servc spec

inputs:
  startcmd:
    description: 'The command to start the service'
    required: false
    default: '../start.sh'
  suite:
    description: 'The test suite to run'
    required: false
    default: ''
  version:
    description: 'The version of the servc spec to test against'
    required: false
    default: 'main'

runs:
  using: 'composite'

  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - uses: actions/setup-python@v5

    - uses: actions/checkout@v4
      with:
        repository: serv-c/docs
        ref: ${{ inputs.version }}
        path: servc-docs
        sparse-checkout: |
          tests
          requirements.test.txt
          config/.placeholder

    - run: pip install -r requirements.test.txt
      shell: bash
      working-directory: servc-docs

    - name: Run tests
      shell: bash
      working-directory: servc-docs
      env:
        START_SCRIPT: ${{ inputs.startcmd }}
      run: python -m unittest tests/${{ inputs.suite }}/**/*.py
